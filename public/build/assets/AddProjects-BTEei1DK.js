import{r as c,j as e,b as D}from"./app-CdL3Sf1p.js";import{l as R,D as T}from"./index.es-CS5NoLKu.js";import{P as k}from"./PrimaryButton-DD7kvWGv.js";import{T as A}from"./TextInput-DPRylTZ6.js";function B(m){const[t,l]=c.useState({message:"",response:"",src:null,processing:!1,data:{title:"",description:"",file:""}}),[d,x]=c.useState(""),[p,h]=c.useState(""),i=c.useRef(null),j=s=>{s.preventDefault();let a;s.dataTransfer?a=s.dataTransfer.files:s.target&&(a=s.target.files);const r=new FileReader;r.onload=()=>{x(r.result)},r.readAsDataURL(a[0])};function w(s,a){const r=s.split(","),u=r[0].match(/:(.*?);/)[1],o=atob(r[1]);let n=o.length;const g=new Uint8Array(n);for(;n--;)g[n]=o.charCodeAt(n);return new File([g],a,{type:u})}const v=()=>{var s,a,r;typeof((s=i.current)==null?void 0:s.cropper)<"u"&&(h((a=i.current)==null?void 0:a.cropper.getCroppedCanvas().toDataURL()),l({...t,data:{...t.data,file:w((r=i.current)==null?void 0:r.cropper.getCroppedCanvas().toDataURL(),"cropped.png")}}))},f=s=>{l({...t,data:{...t.data,[s.target.name]:s.target.value}})},b=async s=>{s.preventDefault(),console.log(t);try{if(p&&t.data.title.length>0&&t.data.description.length>0){l({...t,formError:!1,processing:!0});let a=new FormData;a.append("title",t.data.title),a.append("description",t.data.description),a.append("file",t.data.file);const r={headers:{"content-type":"multipart/form-data"}},o=await D.post("/projects/post",a,r);console.log(o),l({...t,response:o.data,error:!1,src:null,processing:!1,data:{title:"",description:"",file:""}}),window.scrollTo(0,0)}else l({...t,formError:!0,processing:!1})}catch(a){console.error(a.response.data),l({...t,response:a.response.data,error:!0,processing:!1}),window.scrollTo(0,0)}},{crop:S,croppedImageUrl:N,src:E}=t,{closeAdd:C,message:U}=m,y=()=>{C()};return console.log(N),console.log(m.cat),e.jsx("div",{className:"absolute overflow-y-scroll flex top-0 left-0 z-40 justify-center w-full min-h-full bg-dark-blue bg-opacity-50",children:e.jsxs("div",{className:"w-full md:w-11/12 min-h-full bg-white",children:[e.jsx("div",{onClick:y,className:"cursor-pointer close ml-auto",children:e.jsx("i",{className:"las la-times text-3xl"})}),e.jsx("div",{className:"text-center text-xl",children:"Post a writeup"}),!t.error&&t.response&&e.jsx("div",{className:"w-full text-center p-2 text-success-txt bg-[#88ff88]",children:t.response.message}),t.error&&e.jsx("div",{className:"w-full text-center p-2 bg-danger-bg text-danger-txt",children:t.response.message}),t.formError&&e.jsx("p",{className:"bg-danger-bg text-danger-txt",children:"Make sure you fill all fields."}),e.jsx("div",{className:"App p-5",children:e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"picture w-full",children:[e.jsx("div",{className:"",children:e.jsx("input",{className:"",accept:"image/png, image/gif, image/jpg, image/jpeg",type:"file",onChange:j})}),e.jsxs("div",{className:" sm:flex flex-wrap",children:[e.jsxs("div",{className:"",children:[d&&e.jsx(R,{style:{height:400,width:"100%"},initialAspectRatio:16/9,src:d,ref:i,viewMode:1,guides:!0,minCropBoxHeight:10,minCropBoxWidth:10,background:!1,aspectRatio:16/9,responsive:!0,checkOrientation:!1}),d&&e.jsx("button",{className:"my-2 bg-silver p-2 rounded-lg border shadow border-[#aaa]",onClick:v,children:"Crop Image"})]}),e.jsx("div",{className:"px-4",children:p&&e.jsx("img",{alt:"Cropped Image",style:{width:400},src:p})})]})]}),e.jsx("div",{className:"form w-full sm:w-7/12",children:e.jsxs("form",{onSubmit:s=>{b(s)},children:[e.jsx("div",{className:"my-1",children:e.jsx(A,{id:"title",name:"title",autoComplete:"Title",value:t.data.title,onChange:f,className:" w-full",placeholder:"Post Title"})}),e.jsx("div",{className:"my-1",children:e.jsx(T,{id:"description",name:"description",value:t.data.description,onChange:s=>{f(s)},tagName:"p",className:"w-full h-84",rows:"10",placeholder:""})}),e.jsx(k,{className:" bg-blue w-full flex text-center hover:bg-dark-blue",disabled:t.processing,children:e.jsx("p",{className:"text-center mx-auto",children:"Submit"})})]})})]})})]})})}export{B as default};
